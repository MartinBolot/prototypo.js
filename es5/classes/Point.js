define(['./Classify.js'], function($__0) {
  "use strict";
  if (!$__0 || !$__0.__esModule)
    $__0 = {default: $__0};
  var Classify = $__0.default;
  function Point(x, y) {
    Classify.prototype.constructor.call(this);
    if (x === undefined || x === null) {
      this.coords = new Float32Array([x, y]);
    } else if (x.constructor === Array || x.constructor === Float32Array) {
      this.coords = new Float32Array(x);
    } else if (typeof x === 'object' && ('x' in x || 'y' in x)) {
      this.coords = new Float32Array([x.x, x.y]);
    } else {
      this.coords = new Float32Array([x, y]);
    }
  }
  Point.prototype = Object.create(Classify.prototype);
  Point.prototype.constructor = Point;
  Object.mixin(Point.prototype, {
    get x() {
      return this.coords[0];
    },
    set x(x) {
      this.coords[0] = x;
    },
    get y() {
      return this.coords[1];
    },
    set y(y) {
      this.coords[1] = y;
    },
    transform: function(m) {
      var coords0 = this.coords[0];
      this.coords[0] = m[0] * coords0 + m[2] * this.coords[1] + m[4];
      this.coords[1] = m[1] * coords0 + m[3] * this.coords[1] + m[5];
      return this;
    },
    toString: function() {
      return (isNaN(this.coords[0]) ? 'NaN' : Math.round(this.coords[0])) + ' ' + (isNaN(this.coords[1]) ? 'NaN' : Math.round(this.coords[1]));
    },
    toJSON: function() {
      return this.toString();
    },
    _: function(x, y) {
      if (x === undefined || x === null) {
        this.coords[0] = x;
        this.coords[1] = y;
      } else if (x.constructor === Array || x.constructor === Float32Array) {
        this.coords[0] = x[0];
        this.coords[1] = x[1];
      } else if (typeof x === 'object' && ('x' in x || 'y' in x)) {
        this.coords[0] = x.x;
        this.coords[1] = x.y;
      } else {
        this.coords[0] = x;
        this.coords[1] = y;
      }
      return this;
    },
    translate: function(x, y) {
      var p = x instanceof Point ? x : new Point(x, y);
      if (!isNaN(p.coords[0])) {
        this.coords[0] += p.coords[0];
      }
      if (!isNaN(p.coords[1])) {
        this.coords[1] += p.coords[1];
      }
      return this;
    },
    translateX: function(x) {
      this.coords[0] += x;
      return this;
    },
    translateY: function(y) {
      this.coords[1] += y;
      return this;
    }
  });
  Point.prototype.onLine = function(knownCoord, p1, p2) {
    var origin = p1,
        vector = [p2.x - p1.x, p2.y - p1.y];
    if (knownCoord === 'x') {
      this.coords[1] = (this.coords[0] - origin.x) / vector[0] * vector[1] + origin.y;
    } else {
      this.coords[0] = (this.coords[1] - origin.y) / vector[1] * vector[0] + origin.x;
    }
  };
  var $__default = Point;
  return {
    get default() {
      return $__default;
    },
    __esModule: true
  };
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci82IiwiY2xhc3Nlcy9Qb2ludC5qcyIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci81IiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzQiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvMCIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci8zIiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzEiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvMiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxLQUFLLEFBQUMsRUNBZSxlQUFjLEVDQW5DLFVBQVMsSUFBZ0I7O0FDQXpCLEtBQUksS0FBaUIsR0FBSyxFQUFDLGVBQTJCO0FBQzFDLFNBQW9CLEVBQUMsT0FBTSxNQUFtQixDQUFDLENBQUE7QUFBQSxJRkRwRCxTQUFPO0FBRWQsU0FBUyxNQUFJLENBQUcsQ0FBQSxDQUFHLENBQUEsQ0FBQSxDQUFJO0FBQ3RCLFdBQU8sVUFBVSxZQUFZLEtBQUssQUFBQyxDQUFFLElBQUcsQ0FBRSxDQUFDO0FBRTNDLE9BQUssQ0FBQSxJQUFNLFVBQVEsQ0FBQSxFQUFLLENBQUEsQ0FBQSxJQUFNLEtBQUcsQ0FBSTtBQUNwQyxTQUFHLE9BQU8sRUFBSSxJQUFJLGFBQVcsQUFBQyxDQUFDLENBQUMsQ0FBQSxDQUFHLEVBQUEsQ0FBQyxDQUFDLENBQUM7SUFFdkMsS0FBTyxLQUFLLENBQUEsWUFBWSxJQUFNLE1BQUksQ0FBQSxFQUFLLENBQUEsQ0FBQSxZQUFZLElBQU0sYUFBVyxDQUFJO0FBQ3ZFLFNBQUcsT0FBTyxFQUFJLElBQUksYUFBVyxBQUFDLENBQUMsQ0FBQSxDQUFDLENBQUM7SUFFbEMsS0FBTyxLQUFLLE1BQU8sRUFBQSxDQUFBLEdBQU0sU0FBTyxDQUFBLEVBQUssRUFBRSxHQUFFLEdBQUssRUFBQSxD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QUUsQ0FBQSxDQUFDLENBQUEsQ0FBSSxDQUFBLE1BQUssQ0FBRSxDQUFBLENBQUMsQ0FBQSxDQUFJLENBQUEsTUFBSyxFQUFFLENBQUM7SUFDbEY7QUFBQSxFQUNELENBQUE7QUcxSEEsQUFBSSxJQUFBLENBQUEsVUFBUyxFSDRIRSxNRzVIa0IsQUg0SGQsQ0c1SGM7QUNBakM7QUNBQSxnQkFBd0I7QUFBRSx1QkFBd0I7SUFBRTtBQ0FwRCxhQUFTLENBQUcsS0FBRztBQUFBLEdGQVE7QUhFbkIsQ0ZGdUMsQ0FBQztBQytOeEMiLCJmaWxlIjoiY2xhc3Nlcy9Qb2ludC5qcyIsInNvdXJjZVJvb3QiOiIuLiIsInNvdXJjZXNDb250ZW50IjpbImRlZmluZSgkX19wbGFjZWhvbGRlcl9fMCwgJF9fcGxhY2Vob2xkZXJfXzEpOyIsImltcG9ydCBDbGFzc2lmeSBmcm9tICcuL0NsYXNzaWZ5LmpzJztcblxuZnVuY3Rpb24gUG9pbnQoIHgsIHkgKSB7XG5cdENsYXNzaWZ5LnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5jYWxsKCB0aGlzICk7XG5cblx0aWYgKCB4ID09PSB1bmRlZmluZWQgfHzCoHggPT09IG51bGwgKSB7XG5cdFx0dGhpcy5jb29yZHMgPSBuZXcgRmxvYXQzMkFycmF5KFt4LCB5XSk7XG5cblx0fSBlbHNlIGlmICggeC5jb25zdHJ1Y3RvciA9PT0gQXJyYXkgfHwgeC5jb25zdHJ1Y3RvciA9PT0gRmxvYXQzMkFycmF5ICkge1xuXHRcdHRoaXMuY29vcmRzID0gbmV3IEZsb2F0MzJBcnJheSh4KTtcblxuXHR9IGVsc2UgaWYgKCB0eXBlb2YgeCA9PT0gJ29iamVjdCcgJiYgKCAneCcgaW4geCB8fCAneScgaW4geCApICkge1xuXHRcdHRoaXMuY29vcmRzID0gbmV3IEZsb2F0MzJBcnJheShbeC54LCB4LnldKTtcblxuXHR9IGVsc2Uge1xuXHRcdHRoaXMuY29vcmRzID0gbmV3IEZsb2F0MzJBcnJheShbeCwgeV0pO1xuXG5cdH1cbn1cblxuUG9pbnQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShDbGFzc2lmeS5wcm90b3R5cGUpO1xuUG9pbnQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUG9pbnQ7XG5cbk9iamVjdC5taXhpbihQb2ludC5wcm90b3R5cGUsIHtcblxuXHQvLyAueCBhbmQgLnkgYXJlIG1vcmUgY29udmVuaWVudCB0aGFuIC5jb29yZHNbMF0gYW5kIC5jb29yZHNbMV1cblx0Z2V0IHgoKSB7XG5cdFx0cmV0dXJuIHRoaXMuY29vcmRzWzBdO1xuXHR9LFxuXHRzZXQgeCggeCApIHtcblx0XHR0aGlzLmNvb3Jkc1swXSA9IHg7XG5cdH0sXG5cdGdldCB5KCkge1xuXHRcdHJldHVybiB0aGlzLmNvb3Jkc1sxXTtcblx0fSxcblx0c2V0IHkoIHkgKSB7XG5cdFx0dGhpcy5jb29yZHNbMV0gPSB5O1xuXHR9LFxuXG5cdHRyYW5zZm9ybSggbSApIHtcblx0XHR2YXIgY29vcmRzMCA9IHRoaXMuY29vcmRzWzBdO1xuXHRcdHRoaXMuY29vcmRzWzBdID0gbVswXSAqIGNvb3JkczAgKyBtWzJdICogdGhpcy5jb29yZHNbMV0gKyBtWzRdO1xuXHRcdHRoaXMuY29vcmRzWzFdID0gbVsxXSAqIGNvb3JkczAgKyBtWzNdICogdGhpcy5jb29yZHNbMV0gKyBtWzVdO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH0sXG5cblx0dG9TdHJpbmcoKSB7XG5cdFx0cmV0dXJuICggaXNOYU4oIHRoaXMuY29vcmRzWzBdICkgPyAnTmFOJyA6IE1hdGgucm91bmQoIHRoaXMuY29vcmRzWzBdICkgKSArXG5cdFx0XHQnICcgK1xuXHRcdFx0KCBpc05hTiggdGhpcy5jb29yZHNbMV0gKSA/ICdOYU4nIDogTWF0aC5yb3VuZCggdGhpcy5jb29yZHNbMV0gKSApO1xuXHR9LFxuXG5cdHRvSlNPTigpIHtcblx0XHRyZXR1cm4gdGhpcy50b1N0cmluZygpO1xuXHR9LFxuXG5cblxuXHQvLyBUaGUgZm9sbG93aW5nIG1ldGhvZHMgYXJlIGRlcHJlY2F0ZWRcblxuXHQvLyBhIHNldHRlciBmb3IgeC95IGNvb3JkaW5hdGVzIHRoYXQgYmVoYXZlcyBleGFjdGx5IGxpa2UgdGhlIGNvbnN0cnVjdG9yXG5cdF8oeCwgeSkge1xuXHRcdGlmICggeCA9PT0gdW5kZWZpbmVkIHx8wqB4ID09PSBudWxsICkge1xuXHRcdFx0dGhpcy5jb29yZHNbMF0gPSB4O1xuXHRcdFx0dGhpcy5jb29yZHNbMV0gPSB5O1xuXG5cdFx0fSBlbHNlIGlmICggeC5jb25zdHJ1Y3RvciA9PT0gQXJyYXkgfHwgeC5jb25zdHJ1Y3RvciA9PT0gRmxvYXQzMkFycmF5ICkge1xuXHRcdFx0dGhpcy5jb29yZHNbMF0gPSB4WzBdO1xuXHRcdFx0dGhpcy5jb29yZHNbMV0gPSB4WzFdO1xuXG5cdFx0fSBlbHNlIGlmICggdHlwZW9mIHggPT09ICdvYmplY3QnICYmICggJ3gnIGluIHggfHwgJ3knIGluIHggKSApIHtcblx0XHRcdHRoaXMuY29vcmRzWzBdID0geC54O1xuXHRcdFx0dGhpcy5jb29yZHNbMV0gPSB4Lnk7XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5jb29yZHNbMF0gPSB4O1xuXHRcdFx0dGhpcy5jb29yZHNbMV0gPSB5O1xuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH0sXG5cblx0dHJhbnNsYXRlKCB4LCB5ICkge1xuXHRcdHZhciBwID0geCBpbnN0YW5jZW9mIFBvaW50ID9cblx0XHRcdFx0eDpcblx0XHRcdFx0bmV3IFBvaW50KCB4LCB5ICk7XG5cblx0XHRpZiAoICFpc05hTiggcC5jb29yZHNbMF0gKSApIHtcblx0XHRcdHRoaXMuY29vcmRzWzBdICs9IHAuY29vcmRzWzBdO1xuXHRcdH1cblx0XHRpZiAoICFpc05hTiggcC5jb29yZHNbMV0gKSApIHtcblx0XHRcdHRoaXMuY29vcmRzWzFdICs9IHAuY29vcmRzWzFdO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9LFxuXG5cdHRyYW5zbGF0ZVgoIHggKSB7XG5cdFx0dGhpcy5jb29yZHNbMF0gKz0geDtcblx0XHRyZXR1cm4gdGhpcztcblx0fSxcblxuXHR0cmFuc2xhdGVZKCB5ICkge1xuXHRcdHRoaXMuY29vcmRzWzFdICs9IHk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cbn0pO1xuXG5Qb2ludC5wcm90b3R5cGUub25MaW5lID0gZnVuY3Rpb24oIGtub3duQ29vcmQsIHAxLCBwMiApIHtcblx0dmFyIG9yaWdpbiA9IHAxLFxuXHRcdHZlY3RvciA9IFtcblx0XHRcdHAyLnggLSBwMS54LFxuXHRcdFx0cDIueSAtIHAxLnlcblx0XHRdO1xuXG5cdGlmICgga25vd25Db29yZCA9PT0gJ3gnICkge1xuXHRcdHRoaXMuY29vcmRzWzFdID0gKCB0aGlzLmNvb3Jkc1swXSAtIG9yaWdpbi54ICkgLyB2ZWN0b3JbMF0gKiB2ZWN0b3JbMV0gKyBvcmlnaW4ueTtcblx0fSBlbHNlIHtcblx0XHR0aGlzLmNvb3Jkc1swXSA9ICggdGhpcy5jb29yZHNbMV0gLSBvcmlnaW4ueSApIC8gdmVjdG9yWzFdICogdmVjdG9yWzBdICsgb3JpZ2luLng7XG5cdH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUG9pbnQ7XG5cblx0Ly8gXHRyZXR1cm4gUG9pbnQ7XG5cdC8vIH0pO1xuXG5cdC8vIHNvbWUgZnVuY3Rpb25zIG5lZWQgdG8gYmUgYWRkZWQgdG8gdGhlIHByb3RvdHlwZSBhdCBydW50aW1lIHRvIGF2b2lkIGNpcmN1bGFyIGRlcGVuZGVuY3lcblx0LyoucnVuKGZ1bmN0aW9uKFBvaW50LCBwb2ludE9uKSB7XG5cdFx0UG9pbnQucHJvdG90eXBlLm9uID0gcG9pbnRPbjtcblx0fSlcblxuXHQuZmFjdG9yeSgncG9pbnRPbicsIGZ1bmN0aW9uKCBQb2ludCwgbGluZUxpbmVJbnRlcnNlY3Rpb24gKSB7XG5cdFx0Ly8gdGhpcyByZWdleHAgaXMgZHVwbGljYXRlZCBpbiBTZWdtZW50LmpzXG5cdFx0dmFyIHJzdHJhaWdodCA9IC9bTFZNSF0vO1xuXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKCBhcmdzICkge1xuXHRcdFx0dmFyIG9yaWdpbixcblx0XHRcdFx0dmVjdG9yO1xuXG5cdFx0XHQvLyBoYW5kbGUgY2FzZXMgd2hlcmUgYXJncyByZWZlcnMgdG8gdW5kZWZpbmVkIGRhdGFcblx0XHRcdGlmICggYXJncyA9PT0gdW5kZWZpbmVkIHx8ICggYXJncy5jb25zdHJ1Y3RvciA9PT0gQXJyYXkgJiYgKCBhcmdzWzBdID09PSB1bmRlZmluZWQgfHwgYXJnc1sxXSA9PT0gdW5kZWZpbmVkICkgKSApIHtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cblx0XHRcdC8vIHBvaW50IG9uIGEgc2VnbWVudFxuXHRcdFx0aWYgKCAhaXNOYU4oIHRoaXMuY29vcmRzWzBdICkgfHwgIWlzTmFOKCB0aGlzLmNvb3Jkc1sxXSApICkge1xuXG5cdFx0XHRcdC8vIHBvaW50IG9uIGEgc3RyYWlnaHQgbGluZVxuXHRcdFx0XHRpZiAoICggYXJncy5jb21tYW5kICE9PSB1bmRlZmluZWQgJiYgcnN0cmFpZ2h0LnRlc3QoYXJncy5jb21tYW5kKSApIHx8XG5cdFx0XHRcdFx0YXJncy5jb25zdHJ1Y3RvciA9PT0gQXJyYXkgKSB7XG5cdFx0XHRcdFx0Ly8gc2VnbWVudCBmcm9tIHR3byBwb2ludHNcblx0XHRcdFx0XHRpZiAoIGFyZ3MuY29uc3RydWN0b3IgPT09IEFycmF5ICkge1xuXHRcdFx0XHRcdFx0b3JpZ2luID0gYXJnc1swXTtcblx0XHRcdFx0XHRcdHZlY3RvciA9IFtcblx0XHRcdFx0XHRcdFx0YXJnc1sxXS54IC0gYXJnc1swXS54LFxuXHRcdFx0XHRcdFx0XHRhcmdzWzFdLnkgLSBhcmdzWzBdLnlcblx0XHRcdFx0XHRcdF07XG5cblx0XHRcdFx0XHQvLyBTZWdtZW50IGluc3RhbmNlXG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdG9yaWdpbiA9IGFyZ3Muc3RhcnQ7XG5cdFx0XHRcdFx0XHR2ZWN0b3IgPSBbXG5cdFx0XHRcdFx0XHRcdGFyZ3MuZW5kLnggLSBhcmdzLnN0YXJ0LngsXG5cdFx0XHRcdFx0XHRcdGFyZ3MuZW5kLnkgLSBhcmdzLnN0YXJ0Lnlcblx0XHRcdFx0XHRcdF07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCB0aGlzLmNvb3Jkc1swXSApIHtcblx0XHRcdFx0XHRcdHRoaXMuY29vcmRzWzFdID0gKCB0aGlzLmNvb3Jkc1swXSAtIG9yaWdpbi54ICkgLyB2ZWN0b3JbMF0gKiB2ZWN0b3JbMV0gKyBvcmlnaW4ueTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0dGhpcy5jb29yZHNbMF0gPSAoIHRoaXMuY29vcmRzWzFdIC0gb3JpZ2luLnkgKSAvIHZlY3RvclsxXSAqIHZlY3RvclswXSArIG9yaWdpbi54O1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiB0aGlzO1xuXG5cdFx0XHRcdC8vIHBvaW50IG9uIGEgY3VydmVcblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHR9XG5cblx0XHRcdC8vIGludGVyc2VjdGlvblxuXHRcdFx0fSBlbHNlIGlmICggYXJncy5jb25zdHJ1Y3RvciA9PT0gQXJyYXkgJiYgYXJncy5sZW5ndGggPT09IDIgKSB7XG5cblx0XHRcdFx0Ly8gbGluZS1saW5lIGludGVyc2VjdGlvblxuXHRcdFx0XHRpZiAoXHQoIGFyZ3NbMF0uY29uc3RydWN0b3IgPT09IEFycmF5IHx8IHJzdHJhaWdodC50ZXN0KGFyZ3NbMF0uY29tbWFuZCkgKSAmJlxuXHRcdFx0XHRcdFx0KCBhcmdzWzFdLmNvbnN0cnVjdG9yID09PSBBcnJheSB8fCByc3RyYWlnaHQudGVzdChhcmdzWzFdLmNvbW1hbmQpICkgKSB7XG5cblx0XHRcdFx0XHR2YXIgcDEgPSBhcmdzWzBdLmNvbnN0cnVjdG9yID09PSBBcnJheSA/XG5cdFx0XHRcdFx0XHRcdCggYXJnc1swXVswXSBpbnN0YW5jZW9mIFBvaW50ID9cblx0XHRcdFx0XHRcdFx0XHRhcmdzWzBdWzBdOlxuXHRcdFx0XHRcdFx0XHRcdG5ldyBQb2ludCggYXJnc1swXVswXSApICk6XG5cdFx0XHRcdFx0XHRcdGFyZ3NbMF0uc3RhcnQsXG5cdFx0XHRcdFx0XHRwMiA9IGFyZ3NbMF0uY29uc3RydWN0b3IgPT09IEFycmF5ID9cblx0XHRcdFx0XHRcdFx0KCBhcmdzWzBdWzFdIGluc3RhbmNlb2YgUG9pbnQgP1xuXHRcdFx0XHRcdFx0XHRcdGFyZ3NbMF1bMV06XG5cdFx0XHRcdFx0XHRcdFx0bmV3IFBvaW50KCBhcmdzWzBdWzFdICkgKTpcblx0XHRcdFx0XHRcdFx0YXJnc1swXS5lbmQsXG5cdFx0XHRcdFx0XHRwMyA9IGFyZ3NbMV0uY29uc3RydWN0b3IgPT09IEFycmF5ID9cblx0XHRcdFx0XHRcdFx0KCBhcmdzWzFdWzBdIGluc3RhbmNlb2YgUG9pbnQgP1xuXHRcdFx0XHRcdFx0XHRcdGFyZ3NbMV1bMF06XG5cdFx0XHRcdFx0XHRcdFx0bmV3IFBvaW50KCBhcmdzWzFdWzBdICkgKTpcblx0XHRcdFx0XHRcdFx0YXJnc1sxXS5zdGFydCxcblx0XHRcdFx0XHRcdHA0ID0gYXJnc1sxXS5jb25zdHJ1Y3RvciA9PT0gQXJyYXkgP1xuXHRcdFx0XHRcdFx0XHQoIGFyZ3NbMV1bMV0gaW5zdGFuY2VvZiBQb2ludCA/XG5cdFx0XHRcdFx0XHRcdFx0YXJnc1sxXVsxXTpcblx0XHRcdFx0XHRcdFx0XHRuZXcgUG9pbnQoIGFyZ3NbMV1bMV0gKSApOlxuXHRcdFx0XHRcdFx0XHRhcmdzWzFdLmVuZDtcblxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl8oIGxpbmVMaW5lSW50ZXJzZWN0aW9uKCBwMSwgcDIsIHAzLCBwNCApICk7XG5cblx0XHRcdFx0Ly8gY3VydmUtY3VydmUgaW50ZXJzZWN0aW9uXG5cdFx0XHRcdH0gZWxzZSBpZiAoIGFyZ3NbMF0uY29tbWFuZCA9PT0gJ0MnICYmIGFyZ3NbMV0uY29tbWFuZCA9PT0gJ0MnICkge1xuXG5cdFx0XHRcdC8vIGxpbmUtY3VydmUgb3IgY3VydmUtbGluZSBpbnRlcnNlY3Rpb25cblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHR9XG5cblx0XHRcdH1cblx0XHR9O1xuXHR9KSovIiwiZnVuY3Rpb24oJF9fcGxhY2Vob2xkZXJfXzApIHtcbiAgICAgICRfX3BsYWNlaG9sZGVyX18xXG4gICAgfSIsImlmICghJF9fcGxhY2Vob2xkZXJfXzAgfHwgISRfX3BsYWNlaG9sZGVyX18xLl9fZXNNb2R1bGUpXG4gICAgICAgICAgICAkX19wbGFjZWhvbGRlcl9fMiA9IHtkZWZhdWx0OiAkX19wbGFjZWhvbGRlcl9fM30iLCJ2YXIgJF9fZGVmYXVsdCA9ICRfX3BsYWNlaG9sZGVyX18wIiwicmV0dXJuICRfX3BsYWNlaG9sZGVyX18wIiwiZ2V0ICRfX3BsYWNlaG9sZGVyX18wKCkgeyByZXR1cm4gJF9fcGxhY2Vob2xkZXJfXzE7IH0iLCJfX2VzTW9kdWxlOiB0cnVlIl19